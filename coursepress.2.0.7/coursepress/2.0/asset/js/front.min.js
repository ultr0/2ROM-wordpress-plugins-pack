/*! CoursePress - v2.0.7
 * https://premium.wpmudev.org/project/coursepress-pro/
 * Copyright (c) 2017; * Licensed GPLv2+ */
var CoursePress={};CoursePress.Models=CoursePress.Models||{},CoursePress.Events=_.extend({},Backbone.Events),CoursePress.UI=CoursePress.UI||{},CoursePress.utility=CoursePress.utility||{},function(a){CoursePress.SendRequest=Backbone.Model.extend({url:_coursepress._ajax_url+"?action=coursepress_request",parse:function(a){var b=this.get("action");!0===a.success?(this.set("response_data",a.data),this.trigger("coursepress:"+b+"_success",a.data)):(this.set("response_data",{}),this.trigger("coursepress:"+b+"_error",a.data))}}),CoursePress.resetBrowserURL=function(a){window.history.pushState&&window.history.pushState({},null,a)},CoursePress.Focus=function(b){var c,d=a(b);return 0<d.length&&(c=d.offset().top,c-=100,a(window).scrollTop(c)),!1},CoursePress.showError=function(b,c){var d,e=a('<div class="cp-error cp-error-box"></div>'),f=a("<p>"),g=a('<a class="cp-closed">&times;</a>'),h=a(".cp-error-box");0<h.length&&h.remove(),d=function(){e.remove()},f.html(b).appendTo(e),g.prependTo(e).on("click",d),c.prepend(e),CoursePress.Focus(".cp-error-box")},CoursePress.WindowAlert=Backbone.View.extend({className:"cp-mask cp-window-alert",message:"",callback:!1,type:"alert",html:'<div class="cp-alert-container"><p><button type="button" class="button">OK</button></p></div>',events:{"click .button":"remove","click .button-confirmed":"doCallback"},initialize:function(a){_.extend(this,a),Backbone.View.prototype.initialize.apply(this,arguments),this.render()},render:function(){this.container=new Backbone.View({className:"cp-alert-container"}),this.container=this.container.$el.appendTo(this.$el),this.container=this.$el.find(".cp-alert-container"),this.container.addClass("cp-"+this.type),this.container.prepend('<p class="msg">'+this.message+"</p>");var a=new Backbone.View({tagName:"button",attributes:{type:"button",class:"button"}});if(a.$el.html(_coursepress.buttons.ok),this.container.append(a.$el),"prompt"===this.type){var b=new Backbone.View({tagName:"button",attributes:{type:"button",class:"button button-cancel"}});b.$el.html(_coursepress.buttons.cancel),b.$el.insertBefore(a.$el),a.$el.addClass("button-confirmed")}this.$el.appendTo("body")},doCallback:function(){this.callback&&this.callback.apply(this.callback,this)}}),CoursePress.Mask=function(b){b=b||"body";var c=a('<div class="cp-mask mask"></div>');return c.appendTo(b),{mask:c,done:function(){c.remove()}}},CoursePress.UnitProgressIndicator=function(){var b=a("ul.units-archive-list a").css("color"),c=a("body").css("color").replace("rgb(","").replace(")","").split(","),d="rgba("+c[0]+", "+c[1]+", "+c[2]+", 1)",e=a(this).data(),f=b,g="center",h=4.5,i=!0,j={duration:1200,easing:"circleProgressEase"};e.knobFgColor&&(b=e.knobFgColor),e.knobEmptyColor&&(d=e.knobEmptyColor),e.knobTextColor&&(f=e.knobTextColor),e.knobTextAlign&&(g=e.knobTextAlign),e.knobTextDenominator&&(h=e.knobTextDenominator),void 0!==e.knobTextShow&&(i=e.knobTextShow),void 0!==e.knobAnimation&&(j=e.knobAnimation);var k={color:b};a(this).circleProgress({fill:k,emptyFill:d,animation:j});a(this).parents("ul")[0];a(this).on("circle-animation-progress",function(b,c){var d=a(this).data("circle-progress"),e=d.ctx,j=d.size,k=(100*c).toFixed(),l=(100*d.value).toFixed();k=100-k,k<l&&(k=l),e.save(),i&&(e.font=j/h+"px sans-serif",e.textAlign=g,e.textBaseline="middle",e.fillStyle=f,e.fillText(k+"%",j/2+j/80,j/2)),e.restore()}),a(this).on("circle-animation-end",function(){var b=a(this).data("circle-progress"),c=b.ctx,d=b.size,e=(100*b.value).toFixed();b.drawFrame(b.value),i&&(c.font=d/h+"px sans-serif",c.textAlign=g,c.textBaseline="middle",c.fillStyle=f,c.fillText(e+"%",d/2,d/2))});var l=a(this).data("circle-progress"),m=l.ctx,n=l.size,o=(100*l.value).toFixed();i&&(m.font=n/h+"px sans-serif",m.textAlign=g,m.textBaseline="middle",m.fillStyle=f,m.fillText(o+"%",n/2,n/2+n/80)),void 0!==e.knobTextPrepend&&e.knobTextPrepend&&a(this).parent().prepend('<span class="progress">'+o+"%</span>")},CoursePress.unitProgressInit=function(){var b=a(".course-progress-disc");0<b.length&&b.each(CoursePress.UnitProgressIndicator)},CoursePress.Modal=Backbone.Modal.extend({viewContainer:".enrollment-modal-container",submitEl:".done",cancelEl:".cancel",options:"meh",initialize:function(){this.template=_.template(a("#modal-template").html()),this.views=this.getViews()},getViews:function(){var b={},c=a('[data-type="modal-step"]');if(0!==c.length)return a.each(c,function(c,d){var e=c+1,f=a(d).attr("id");void 0!==f&&(b["click #step"+e]={view:_.template(a("#"+f).html()),onActive:"setActive"})}),b},events:{"click .previous":"previousStep","click .next":"nextStep","click .cancel-link":"closeDialog"},previousStep:function(a){a.preventDefault(),this.previous(),"function"==typeof this.onPrevious&&this.onPrevious()},nextStep:function(a){a.preventDefault(),this.next(),"function"==typeof this.onNext&&this.onNext()},closeDialog:function(){return a(".enrolment-container-div").detach(),!1},setActive:function(a){this.trigger("modal:updated",{view:this,options:a})},cancel:function(){return a(".enrolment-container-div").detach(),!1}}),CoursePress.removeErrorHint=function(){a(this).removeClass("has-error")},CoursePress.actions=CoursePress.actions||{},CoursePress.filters=CoursePress.filters||{},CoursePress.add_action=function(a,b,c){void 0===c&&(c=10),CoursePress.actions[a]=CoursePress.actions[a]||[],CoursePress.actions[a].push({priority:c,callback:b})},CoursePress.add_filter=function(a,b,c){void 0===c&&(c=10),CoursePress.filters[a]=CoursePress.filters[a]||[],CoursePress.filters[a].push({priority:c,callback:b})},CoursePress.remove_action=function(a,b){CoursePress.filters[a]=CoursePress.filters[a]||[],CoursePress.filters[a].forEach(function(c,d){c.callback===b&&CoursePress.filters[a].splice(d,1)})},CoursePress.remove_filter=function(a,b){CoursePress.filters[a]=CoursePress.filters[a]||[],CoursePress.filters[a].forEach(function(c,d){c.callback===b&&CoursePress.filters[a].splice(d,1)})},CoursePress.do_action=function(a,b){var c=[];void 0!==CoursePress.actions[a]&&CoursePress.actions[a].length>0&&(CoursePress.actions[a].forEach(function(a){c[a.priority]=c[a.priority]||[],c[a.priority].push(a.callback)}),c.forEach(function(a){a.forEach(function(a){a(b)})}))},CoursePress.apply_filters=function(a,b,c){var d=[];return void 0!==CoursePress.filters[a]&&CoursePress.filters[a].length>0&&(CoursePress.filters[a].forEach(function(a){d[a.priority]=d[a.priority]||[],d[a.priority].push(a.callback)}),d.forEach(function(a){a.forEach(function(a){b=a(b,c)})})),b},CoursePress.procederDataLink=function(b){var c=b.currentTarget;a(c).attr("data-link")&&(window.location.href=a(c).attr("data-link"))},a(document).ready(CoursePress.unitProgressInit).on("focus",".cp-mask .has-error, .cp .has-error",CoursePress.removeErrorHint).on("click",".single_show_cart_button",CoursePress.procederDataLink)}(jQuery),function(a){CoursePress.timer=function(a){var b=a.find(".quiz_timer").show(),c=a.find(".module-elements");if(0!==b.length){if(!c.is(":visible"))return void b.hide();var d,e,f,g,h,i,j=b.data("limit"),k=b.data("retry"),l=0,m=0,n=0,o=0,p=60,q="00",r="00";if(j=j.split(":"),n=j.pop(),p=n=parseInt(n),j.length>0&&(q=m=j.pop(),m=60*parseInt(m)),j.length>0&&(r=l=j.pop(),l=60*parseInt(l)*60),o=l+m+n,f=a.find(".quiz_timer_info"),i=a.find(".module-elements input, .module_elements select, .module-elements textarea"),i.removeAttr("disabled"),h=function(){i.attr("disabled","disabled"),f.show()},0===o)return void("no"===k?h():b.hide());d=setInterval(function(){60==p&&parseInt(q)>0&&(q=parseInt(q)-1),p=parseInt(p)-1,p<=0&&q<=0&&r<=0&&(clearInterval(d),h(),g=new CoursePress.SendRequest,g.set({cpnonce:_coursepress.cpnonce,className:"CoursePress_Module",method:"record_expired_answer",module_id:a.data("id"),course_id:a.find('[name="course_id"]').val(),unit_id:a.find('[name="unit_id"]').val(),student_id:a.find('[name="student_id"]').val(),action:"record_time"}),g.save(),f.on("click",function(){i.removeAttr("disabled"),f.hide(),CoursePress.timer(a)})),p<0&&(p=59,parseInt(q)>0&&(q=parseInt(q)-1),parseInt(q)<=0&&parseInt(r)>0&&(r=parseInt(r)-1,q=59,r<10&&(r="0"+parseInt(r)))),p<10&&(p="0"+parseInt(p)),q<10&&(q="0"+parseInt(q)),e="00"==r?q+":"+p:r+":"+q+":"+p,b.html(e)},1e3)}},CoursePress.MediaElements=function(b){if(a.fn.mediaelementplayer){var c=a("audio,video",b);c.length>0&&c.mediaelementplayer()}},CoursePress.LoadFocusModule=function(){var b=a(this),c=b.data(),d=a(".coursepress-focus-view"),e=[_coursepress.home_url,"coursepress_focus"],f=a(".cp, .coursepress-focus-view");if("submit"!==b.attr("type")){if("course"===c.type)return void(window.location=c.url);if(c.unit){var g=f.find('[name="unit_id"]');if(0===g.length||c.unit!==g.val())return void(window.location=c.url)}return e.push(c.course,c.unit,c.type,c.id),e=e.join("/"),d.load(e,function(){CoursePress.resetBrowserURL(c.url),CoursePress.timer(d.find(".cp-module-content")),CoursePress.MediaElements(d.find(".cp-module-content"))}),!1}},CoursePress.validateUploadModule=function(){var b=a(this),c=b.parents(".module-elements").first(),d=c.find(".invalid-extension, .current-file"),e=b.val(),f=e.split(".").pop(),g=_.keys(_coursepress.allowed_student_extensions);if(0<d.length&&d.detach(),_.contains(g,f)){var h=b.get(0);if(h.files&&h.files.length)for(var i=0;i<h.files.length;i++)e=h.files[i].name;d=a('<div class="current-file"></div>').html(e),d.insertAfter(b.parent())}else d=a('<div class="invalid-extension">').insertAfter(b.parent()),d.html(_coursepress.invalid_upload_message)},CoursePress.ModuleSubmit=function(){var b,c=a(this),d=c.find(".cp-error-box"),e=c.parents(".coursepress-focus-view, .cp.unit-wrapper"),f=!1,g=!1,h=a('.module-elements[data-required="1"]',c),i=h.next(".module-response"),j=c.parents(".coursepress-focus-view").length>0,k=0,l=a("[name=save_progress_and_exit]").length<1;if(0<d.length&&d.remove(),l&&(h.each(function(){var b,c=a(this),d=c.data("type");_.contains(["input-checkbox","input-radio","input-quiz"],d)?(b=a(":checked",c),0==b.length&&(k+=1)):"input-upload"===d&&0===i.length?(b=a('[type="file"]',c),""===b.val()&&(k+=1)):_.contains(["input-text","input-textarea","input-select"],d)&&(b=a("input,textarea,select",c),""===b.val()&&(k+=1))}),k>0))return new CoursePress.WindowAlert({message:_coursepress.module_error[j?"required":"normal_required"]}),!1;b=CoursePress.Mask(),c.append('<input type="hidden" name="is_cp_ajax" value="1" />'),f=a('<iframe name="cp_submitter" style="display:none;">').insertBefore(c),c.attr("target","cp_submitter"),f.on("load",function(){var c=a(this).contents().find("body");g=setInterval(function(){var a=c.text();if(""!=a){clearInterval(g),b.done();var d=window.JSON.parse(a);!0===d.success?d.data.url&&(!1===j||!0===d.data.is_reload||d.data.type&&"completion"===d.data.type?window.location=d.data.url:(e.html(d.data.html),CoursePress.resetBrowserURL(d.data.url),CoursePress.timer(e.find(".cp-module-content")),CoursePress.MediaElements(e.find(".cp-module-content")))):(d.data.html&&e.html(d.data.html),new CoursePress.WindowAlert({message:d.data.error_message}))}},100)})},CoursePress.toggleModuleState=function(){var b=a(this),c=b.closest(".cp-module-content"),d=a(".module-elements",c);return a(".module-response",c).hide(),d.show(),!1},CoursePress.commentReplyLink=function(){var b=a(this),c=b.parents("[data-comid]").first(),d=c.data("comid"),e=b.parents(".cp-module-content").first(),f=a("#respond",e),g=a("#comment-"+d),h=a('[name="comment_parent"]',f),i=a(".cp-temp-div"),j=f.find("#cancel-comment-reply-link");return 0===i.length&&(i=a('<div class="cp-temp-div"></div>').insertAfter(f)),h.val(d),f.hide(),g.append(f.slideDown()),j.off("click"),j.show().on("click",function(){return f.insertBefore(i),j.hide(),i.remove(),!1}),CoursePress.Focus(f),f.find('textarea[name="comment"]').focus(),!1},CoursePress.addComment=function(b){var c,d,e=a(this),f=e.parents(".cp-module-content").first(),g=a("#respond",f),h=a(".cp-comment-form",f),i=a('[name="comment"]',g),j=a('[name="comment_parent"]',g),k=a('[name="comment_post_ID"]',g),l=a('[name="coursepress_subscribe"]',g),m=a('[name="student_id"]',f),n=a('[name="course_id"]',f),o=a('[name="module_content"]',f),p=a(".cp-error-box",g),q=a(".comment-list",f),r={},s=0<parseInt(j.val()),t=new CoursePress.SendRequest;return p.remove(),""===i.val()?(new CoursePress.WindowAlert({message:_coursepress.comments.require_valid_comment}),b.stopImmediatePropagation(),!1):(r={comment:i.val(),comment_parent:j.val(),comment_post_ID:k.val(),subscribe:l.val(),cpnonce:_coursepress.cpnonce,method:"add_single_comment",className:"CoursePress_Module",course_id:n,unit_id:o,student_id:m.val(),action:"add_single_comment"},d=CoursePress.Mask(),c=function(){var a=g.find("#cancel-comment-reply-link");i.val(""),j.val(""),a.is(":visible")&&a.trigger("click"),d.done()},t.set(r),t.off("coursepress:add_single_comment_success"),t.on("coursepress:add_single_comment_success",function(b){c(),0<q&&(q=a('<ol class="comment-list"></ol>').insertAfter(g));var d,e=q,f=h.is(".comment-form-desc")?"append":"prepend";!0===s?(e=a("#comment-"+r.comment_parent),d=e.find(".children"),0===d.length?(e.append('<ul class="children"></ul>'),d=e.find(".children")):d="append"===f?d.last():d.first(),d[f](b.html)):e[f](b.html),CoursePress.Focus("#comment-"+b.comment_id)}),t.on("coursepress:add_single_comment_error",function(){d.done(),CoursePress.showError(_coursepress.server_error,g)}),t.save(),b.stopImmediatePropagation(),!1)},CoursePress.singleFolded=function(){var b=a(">ul",a(this).parent()),c=a(".unit-archive-single-title",a(this).parent()),d=a(".unit-archive-module-wrapper",a(this).parent()),e=a(this);return e.hasClass("folded")?b.slideDown(function(){e.removeClass("folded"),e.closest("li").removeClass("folded").addClass("unfolded"),c.attr("href",c.data("original-href")),c.off("click")}):b.slideUp(function(){if(e.addClass("folded"),e.closest("li").removeClass("unfolded").addClass("folded"),void 0===c.data("href")){var b=a(".module-seen",d).last();if(b.length&&(b=a(".module-title",b),b.length))return c.attr("href",c.attr("href")+"#module-"+b.data("id")),!1;var f=a(".section-seen",d).last();if(f.length&&(f=a(".section-title",f),f.length))return c.attr("href",c.attr("href")+"#section-"+f.data("id")),!1}}),!1},CoursePress.unitFolded=function(){var b=a(this),c=b.parents("li").first(),d=c.find(".unit-structure-modules");c.is(".folded")?(c.removeClass("folded").addClass("unfolded"),b.removeClass("folded"),d.slideDown()):(c.removeClass("unfolded").addClass("folded"),b.addClass("folded"),d.slideUp())},CoursePress.saveProgressAndExit=function(){var b=a(this).closest("form");a("#respond",b).detach(),b.append('<input type="hidden" name="save_progress_and_exit" value="1" />'),b.submit()},a(document).ready(function(){CoursePress.timer(a(".cp-module-content"))}).on("submit",".cp-form",CoursePress.ModuleSubmit).on("click",".focus-nav-prev, .focus-nav-next",CoursePress.LoadFocusModule).on("click",".button-reload-module",CoursePress.toggleModuleState).on("click",".cp-module-content .comment-reply-link",CoursePress.commentReplyLink).on("click",".cp-comment-submit",CoursePress.addComment).on("change",".cp-module-content .file input",CoursePress.validateUploadModule).on("click",".unit-archive-single .fold",CoursePress.singleFolded).on("click",".course-structure-block .unit .fold, .unit-archive-list .fold",CoursePress.unitFolded).on("click",".save-progress-and-exit",CoursePress.saveProgressAndExit)}(jQuery),function(a){function b(b){if(void 0===b)return!1;var c,d=a(a('[data-type="modal-step"]')[b]).attr("data-modal-action"),e=a(".enrollment-modal-container.bbm-modal__views").attr("data-nonce");if(CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action",d),!("signup"===d&&"function"==typeof(c=CoursePress.Enrollment.dialog.signup_validation)&&!0!==c()||"login"===d&&"function"==typeof(c=CoursePress.Enrollment.dialog.login_validation)&&!0!==c())){var f={nonce:e,step:b};c=CoursePress.Enrollment.dialog[d+"_data"],"function"==typeof c&&(f=c(f)),"signup"==d&&a("input.signup").after('<span class="fa fa-circle-o-notch fa-spin fa-2x fa-fw"></span>'),CoursePress.Post.set("data",f),CoursePress.Post.save(),CoursePress.Post.on("coursepress:enrollment:"+d+"_success",function(b){if(a(".enrollment-modal-container.bbm-modal__views").attr("data-nonce",b.nonce),void 0!==b.callback&&"function"==typeof(c=CoursePress.Enrollment.dialog[b.callback]))return void c(b);void 0!==b.last_step&&parseInt(b.last_step)<CoursePress.Enrollment.dialog.views.length-1&&(CoursePress.Enrollment.dialog.openAt(parseInt(b.last_step)+1),a(".enrolment-container-div").removeClass("hidden"))}),CoursePress.Post.on("coursepress:enrollment:"+d+"_error",function(a){if(void 0!==a.callback&&"function"==typeof(c=CoursePress.Enrollment.dialog[a.callback]))return void c(a)})}}CoursePress.Models.CourseFront=Backbone.Model.extend({url:_coursepress._ajax_url+"?action=course_front",parse:function(a){!0===a.success?(this.set("response_data",a.data),this.trigger("coursepress:"+a.data.action+"_success",a.data)):(this.set("response_data",{}),a.data&&this.trigger("coursepress:"+a.data.action+"_error",a.data))},defaults:{}}),CoursePress.Models.Post=CoursePress.Models.Post||Backbone.Model.extend({url:_coursepress._ajax_url+"?action=",parse:function(a){var b=this.get("context");if(!0===a.success){void 0===a.data&&(a.data={}),this.set("response_data",a.data);var c="coursepress:"+b+a.data.action+"_success";this.trigger(c,a.data)}else 0!==a&&(this.set("response_data",{}),this.trigger("coursepress:"+b+a.data.action+"_error",a.data));CoursePress.Post.set("action","")},prepare:function(a,b){this.url=this.get("base_url")+a,void 0!==b&&this.set("context",b)},defaults:{base_url:_coursepress._ajax_url+"?action=",context:"response:"}}),CoursePress.Post=new CoursePress.Models.Post,CoursePress.checkWeakPassword=function(){var b=a(this).closest("form"),c=a('[name="password"]',b),d=a('[name="password_confirmation"]',b),e=a(".password-strength-meter",b),f=a(".weak-password-confirm",b),g=a('[name="password_strength_level"]',b);if(void 0!==wp.passwordStrength.meter){var h=c.val(),i=d.val();if(f.hide(),e.removeClass("short bad good strong").html(""),h||i){var j=wp.passwordStrength.meter(h,wp.passwordStrength.userInputBlacklist(),i);switch(g.val(j),j){case 2:e.addClass("bad").html(pwsL10n.bad);break;case 3:e.addClass("good").html(pwsL10n.good);break;case 4:e.addClass("strong").html(pwsL10n.strong);break;case 5:e.addClass("bad").html(pwsL10n.mismatch);break;default:e.addClass("bad").html(pwsL10n.short)}j<3&&f.show()}}},CoursePress.Dialogs={beforeSubmit:function(){var c=this.currentIndex;return b(c),c===CoursePress.Enrollment.dialog.views.length-1&&a(".enrolment-container-div").addClass("hidden"),!1},openAtAction:function(b){var c=a('[data-type="modal-step"]');a.each(c,function(c,d){var e=a(d).attr("data-modal-action");void 0!==e&&b===e&&(CoursePress.Enrollment.dialog.openAt(c),"login"==b&&a(window).scrollTop(a("div.cp-mask.enrolment-container-div").offset().top-100))})},handle_signup_return:function(b){var c=b.signup_errors,d=a('[data-type="modal-step"]');if(a("span.fa-circle-o-notch").detach(),0===c.length&&!0===b.user_data.logged_in)_coursepress.invitation_data?CoursePress.Enrollment.dialog.add_instructor(b):a.each(d,function(c,d){var e=a(d).attr("data-modal-action");"yes"===_coursepress.current_course_is_paid&&"paid_enrollment"===e?CoursePress.Enrollment.dialog.openAt(c):"enrolled"===e&&(b.already_enrolled?location.href=_coursepress.course_url:CoursePress.Enrollment.dialog.attempt_enroll(b))});else if(c.length>0){a(".bbm-wrapper #error-messages").html("");var e="<ul>";c.forEach(function(a){e+="<li>"+a+"</li>"}),e+="</ul>",a(".bbm-wrapper #error-messages").html(e),a("input[name=password]").val(""),a("input[name=password_confirmation]").val("")}else a.each(d,function(a,b){"login"===b.attr("data-modal-action")&&CoursePress.Enrollment.dialog.openAt(a)})},handle_login_return:function(b){var c=b.signup_errors,d=a('[data-type="modal-step"]');if(0===c.length&&!0===b.logged_in)_coursepress.invitation_data?CoursePress.Enrollment.dialog.add_instructor(b):a.each(d,function(c,d){var e=a(d).attr("data-modal-action");"yes"===_coursepress.current_course_is_paid&&"paid_enrollment"===e?CoursePress.Enrollment.dialog.openAt(c):"enrolled"===e&&(b.already_enrolled?location.href=_coursepress.course_url:CoursePress.Enrollment.dialog.attempt_enroll(b))});else if(c.length>0){a(".bbm-wrapper #error-messages").html("");var e="<ul>";c.forEach(function(a){e+="<li>"+a+"</li>"}),e+="</ul>",a(".bbm-wrapper #error-messages").html(e),a("input[name=password]").val("")}},handle_enroll_student_return:function(b){var c=a('[data-type="modal-step"]');!0===b.success?a.each(c,function(b,c){var d=a(c).attr("data-modal-action");"yes"===_coursepress.current_course_is_paid&&"paid_enrollment"===d?CoursePress.Enrollment.dialog.openAt(b):"enrolled"===d&&CoursePress.Enrollment.dialog.openAt(b)}):a.each(c,function(b,c){var d=a(c).attr("data-modal-action");"passcode"==_coursepress.current_course_type&&"passcode"===d&&CoursePress.Enrollment.dialog.openAt(b)}),a(".enrolment-container-div").removeClass("hidden")},signup_validation:function(){var b=!0;a(".bbm-wrapper #error-messages").html("");var c=[];if(""!==a("input[name=first_name]").val().trim()&&""!==a("input[name=last_name]").val().trim()&&""!==a("input[name=username]").val().trim()&&""!==a("input[name=email]").val().trim()&&""!==a("input[name=password]").val().trim()&&""!==a("input[name=password_confirmation]").val().trim()||(b=!1,c.push(_coursepress.signup_errors.all_fields)),void 0!==wp.passwordStrength.meter){var d=a('[name="confirm_weak_password"]'),e=wp.passwordStrength.meter(a('[name="password"]').val(),[],a('[name="password_confirmation"]').val());e<=2&&!d.is(":checked")&&(b=!1,c.push(_coursepress.signup_errors.weak_password)),5===e&&(b=!1,c.push(_coursepress.signup_errors.mismatch_password))}if(c.length>0){var f="<ul>";c.forEach(function(a){f+="<li>"+a+"</li>"}),f+="</ul>",a(".bbm-wrapper #error-messages").first().html(f)}return b},login_validation:function(){var b=!0,c=a(".bbm-wrapper #error-messages"),d=a('input[name="log"]'),e=a('input[name="pwd"]');return c.html(""),d.removeClass("has-error"),e.removeClass("has-error"),""===d.val().trim()&&(b=!1,d.addClass("has-error")),""===e.val().trim()&&(b=!1,e.addClass("has-error")),b},signup_data:function(b){return b.first_name=a("input[name=first_name]").val(),b.last_name=a("input[name=last_name]").val(),b.username=a("input[name=username]").val(),b.email=a("input[name=email]").val(),b.password=a("input[name=password]").val(),b.nonce=a(".bbm-modal-nonce.signup").attr("data-nonce"),b},login_data:function(b){var c=a(".enrollment-modal-container.bbm-modal__views").attr("data-course");return b.username=a("input[name=log]").val(),b.password=a("input[name=pwd]").val(),b.course_id=c,b.nonce=a(".bbm-modal-nonce.login").attr("data-nonce"),b},attempt_enroll:function(b){var c=a(".enrollment-modal-container.bbm-modal__views").attr("data-nonce"),d=a(".enrollment-modal-container.bbm-modal__views").attr("data-course"),e=a(".cp-mask");if(void 0===c||void 0===d){var f=a(document.createElement("div"));f.html(_.template(a("#modal-template").html())()),f=a(f).find(".enrollment-modal-container")[0],c=a(f).attr("data-nonce"),d=a(f).attr("data-course")}CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action","enroll_student");var g={nonce:c,student_id:b.user_data.ID,course_id:d,step:""};CoursePress.Post.set("data",g),CoursePress.Post.save(),CoursePress.Post.off("coursepress:enrollment:enroll_student_error"),CoursePress.Post.on("coursepress:enrollment:enroll_student_error",function(a){if(void 0!==a.callback){var b=CoursePress.Enrollment.dialog[a.callback];if("function"==typeof b)return void b(a)}}),CoursePress.Post.off("coursepress:enrollment:enroll_student_success"),CoursePress.Post.on("coursepress:enrollment:enroll_student_success",function(b){if(e.removeClass("loading"),a(".enrollment-modal-container.bbm-modal__views").attr("data-nonce",b.nonce),void 0!==b.callback){var c=CoursePress.Enrollment.dialog[b.callback];if("function"==typeof c)return void c(b)}})},new_nonce:function(a,b){CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action","get_nonce");var c={action:"get_nonce",nonce:a,step:""};CoursePress.Post.set("data",c),CoursePress.Post.save(),CoursePress.Post.off("coursepress:enrollment:get_nonce_success"),CoursePress.Post.on("coursepress:enrollment:get_nonce_success",b)},add_instructor:function(a){CoursePress.Enrollment.dialog.new_nonce("coursepress_add_instructor",function(b){var c=_coursepress.invitation_data.course_id;CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action","add_instructor");var d={action:"add_instructor",nonce:b.nonce,course_id:c,invite_code:_coursepress.invitation_data.code,instructor_id:a.user_data.ID,step:""};CoursePress.Post.set("data",d),CoursePress.Post.save(),CoursePress.Post.off("coursepress:enrollment:add_instructor_success"),CoursePress.Post.on("coursepress:enrollment:add_instructor_success",function(){CoursePress.Enrollment.dialog.openAtAction("instructor-verified")}),CoursePress.Post.off("coursepress:enrollment:add_instructor_error"),CoursePress.Post.on("coursepress:enrollment:add_instructor_error",function(){CoursePress.Enrollment.dialog.openAtAction("verification-failed")})})},init:function(){CoursePress.Enrollment.dialog||(CoursePress.Enrollment.dialog=new CoursePress.Modal,_.extend(CoursePress.Enrollment.dialog,CoursePress.Dialogs))}},CoursePress.Enrollment=CoursePress.Enrollment||{},CoursePress.CustomLoginHook=function(){a(this).attr("href","#");var b=a('<div class="cp-mask enrolment-container-div">');return b.appendTo("body"),CoursePress.Dialogs.init(),b.html(CoursePress.Enrollment.dialog.render().el),CoursePress.Enrollment.dialog.openAtAction("login"),!1},CoursePress.EnrollStudent=function(){var b=a('<div class="cp-mask enrolment-container-div">');if(b.appendTo("body"),CoursePress.Dialogs.init(),"yes"===_coursepress.current_course_is_paid)a(b).html(CoursePress.Enrollment.dialog.render().el),CoursePress.Enrollment.dialog.openAtAction("paid_enrollment");else{a(b).addClass("loading");var c={user_data:{ID:parseInt(_coursepress.current_student)}};CoursePress.Enrollment.dialog.attempt_enroll(c),a(b).html(CoursePress.Enrollment.dialog.render().el)}return!1},CoursePress.validateEnrollment=function(){a(this);return!1},CoursePress.validatePassCode=function(){var b=a(this),c=b.find('[name="passcode"]');return student_id=b.find('[name="student_id"]').val(),course_id=b.find('[name="course_id"]').val(),""===c.val()?(new CoursePress.WindowAlert({message:_coursepress.module_error.passcode_required}),!1):(CoursePress.Post.prepare("course_enrollment","enrollment:"),CoursePress.Post.set("action","enroll_with_passcode"),CoursePress.Post.set("data",{passcode:c.val(),student_id:student_id,course_id:course_id,step:0}),CoursePress.Post.off("coursepress:enrollment:enroll_with_passcode_success"),CoursePress.Post.on("coursepress:enrollment:enroll_with_passcode_success",function(b){var c=a('<div class="cp-mask enrolment-container-div">');c.appendTo("body"),CoursePress.Dialogs.init(),a(c).html(CoursePress.Enrollment.dialog.render().el),CoursePress.Enrollment.dialog.openAtAction("enrolled")}),CoursePress.Post.off("coursepress:enrollment:enroll_with_passcode_error"),CoursePress.Post.on("coursepress:enrollment:enroll_with_passcode_error",function(a){new CoursePress.WindowAlert({message:a.message})}),CoursePress.Post.save(),!1)},a(document).on("click",".cp-custom-login",CoursePress.CustomLoginHook).on("click",".apply-button.enroll",CoursePress.EnrollStudent).on("submit",'[name="enrollment-process"][data-type="passcode"]',CoursePress.validatePassCode).on("keyup",'.signup-form [name="password"], .signup-form [name="password_confirmation"]',CoursePress.checkWeakPassword).on("submit",".apply-box .enrollment-process",CoursePress.validateEnrollment)}(jQuery),function(a){var b=function(){var b=a(this).attr("href");new CoursePress.WindowAlert({type:"prompt",message:_coursepress.confirmed_withdraw,callback:function(){window.location=b}});return!1},c=function(){var b=a(this).data("link");new CoursePress.WindowAlert({type:"prompt",message:_coursepress.confirmed_edit,callback:function(){window.location=b}});return!1};a(document).on("click",".cp-withdraw-student",b).on("click",".coursepress-course-link",c)}(jQuery);